language: cpp
dist: xenial
env:
matrix:
    fast_finish: true
    include:
      - os: linux
        addons:
            apt:
                sources:
                    - ubuntu-toolchain-r-test
                packages:
                    - g++-7
      - os: osx
        osx_image: xcode8
        compiler: clang
      - os: osx
        osx_image: xcode9
        compiler: clang
      - os: osx
        osx_image: xcode11
        compiler: clang
      - os: osx
        osx_image: xcode12
        compiler: clang
env:
    global:
        - MINCONDA_VERSION="latest"
        - MINCONDA_LINUX="Linux-x86_64"
        - MINCONDA_OSX="MacOSX-x86_64"
before_install:
        - |
            # Configure build variables
            if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
                if [[ "$COMPILER" == "gcc" ]]; then
                    export CXX=g++-$GCC CC=gcc-$GCC;
                fi
                if [[ "$COMPILER" == "clang" ]]; then
                    export CXX=clang++-$CLANG CC=clang-$CLANG;
                fi
            elif [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
                export CXX=clang++ CC=clang;
            fi
install:
    # Set environment using Conda
    - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
            MINCONDA_OS=$MINCONDA_LINUX;
        elif [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
            MINCONDA_OS=$MINCONDA_OSX;
        fi
    - wget "http://repo.continuum.io/miniconda/Miniconda3-$MINCONDA_VERSION-$MINCONDA_OS.sh" -O miniconda.sh;
    - bash miniconda.sh -b -p $HOME/miniconda
    - export PATH="$HOME/miniconda/bin:$PATH"
    - hash -r
    - conda config --set always_yes yes --set changeps1 no
    - conda update -q conda
    - conda install -c conda-forge mamba==0.5.3
    - mamba install -c conda-forge xtensor xsimd
script:
    - echo "Done"